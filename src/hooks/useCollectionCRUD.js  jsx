import { useState, useEffect, useCallback } from 'react';
import { db } from '../firebase';
import {
  collection,
  getDocs,
  addDoc,
  doc,
  deleteDoc,
} from 'firebase/firestore';

/**
 * Re-usable CRUD helper for any top-level collection.
 *   const { docs, addItem, deleteItem } = useCollectionCRUD('flyers');
 */
export default function useCollectionCRUD(collectionName) {
  const [docs, setDocs] = useState([]);

  const refresh = useCallback(async () => {
    const snap = await getDocs(collection(db, collectionName));
    setDocs(snap.docs.map((d) => ({ id: d.id, ...d.data() })));
  }, [collectionName]);

  const addItem = useCallback(
    async (data) => {
      await addDoc(collection(db, collectionName), data);
      await refresh();
    },
    [collectionName, refresh]
  );

  const deleteItem = useCallback(
    async (id) => {
      await deleteDoc(doc(db, collectionName, id));
      await refresh();
    },
    [collectionName, refresh]
  );

  useEffect(() => {
    refresh();
  }, [refresh]);

  return { docs, addItem, deleteItem, refresh };
}